<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tattoo CRM — Clients · Calendar · Marketing</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
 <div class="background-fixed"></div>
  <div class="container">
  <header class="app-header glass">
  <div class="header-actions">
    <button id="btnConnectDrive" class="btn primary">
      <span class="btn-icon">☁</span><span>Подключить Drive</span>
    </button>
    <span id="driveStatus" class="chip">Drive: оффлайн</span>
<span id="calStatus" class="status-pill bad" title="">Calendar: offline</span>
    <button id="btnSettings" class="icon-btn" aria-label="Настройки" title="Настройки">
      <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
        <path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm9 3.5a7.8 7.8 0 0 0-.14-1.43l2.03-1.58-1.9-3.29-2.46.83a7.9 7.9 0 0 0-2.47-1.43l-.37-2.56h-3.8l-.36 2.56A7.9 7.9 0 0 0 7.62 4.1l-2.46-.83-1.9 3.3 2.03 1.57c-.1.47-.14.95-.14 1.44s.05.97.14 1.44L3.26 13.6l1.9 3.3 2.46-.84a7.9 7.9 0 0 0 2.47 1.44l.36 2.56h3.8l.37-2.56a7.9 7.9 0 0 0 2.47-1.44l2.46.84 1.9-3.3-2.03-1.58c.1-.47.14-.95.14-1.44Z"/>
      </svg>
    </button>
  </div>
</header>


  <main id="app">
    <!-- Стартовый мастер (вход через Google) -->
    <section id="onboarding" class="page is-active">
      <div class="card glass">
        <h2>Добро пожаловать</h2>
        <p>Войдите через Google, чтобы хранить клиентов, записи и фото в Firestore и Google Drive.</p>

        <div class="y-16"></div>
        <button id="bootstrapBtn" class="btn success wide">Войти через Google</button>

        <div class="y-12"></div>
        <button id="demoBtn" class="btn ghost">Запустить демо</button>
      </div>
    </section>

    <!-- Вкладка: Сегодня -->
    <section id="todayPage" class="page">
      <div class="section">
        <h2>Сегодня</h2>
        <div id="todaySchedule" class="list"></div>
      </div>
      <div class="section">
        <h3>Напоминания</h3>
        <div id="remindersList"></div>
      </div>
    </section>
<div class="row" style="gap:8px; align-items:center">
  <h3>Календарь (Tattoo CRM)</h3>
  <button id="btnTestCalendar" class="btn ghost" type="button">Проверить календарь</button>
</div>
<div id="todayCalendar" class="card glass"></div>
<!-- Подключаем стили/скрипты FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>


    <!-- Вкладка: Клиенты -->
    <section id="clientsPage" class="page">
      <div class="toolbar glass">
        <input id="searchInput" class="search" placeholder="Поиск: имя, телефон, стиль…" />
        <button id="addClientBtn" class="btn success">+ Клиент</button>
      </div>

      <div class="filters-row">
        <select id="filterSource" class="chip">
          <option value="">Источник: все</option>
        </select>
        <select id="filterStatus" class="chip">
          <option value="">Статус: все</option>
        <option>Холодный лид</option><option>Лид</option><option>Консультация</option>
  <option>Предоплата\эскиз</option>
  <option>Сеанс</option><option>Отменил</option><option>Слился</option>
        </select>
<!-- новый селект сортировки -->
  <select id="sortClients" class="chip">
    <option value="updatedAt">Сортировка: по изменению</option>
    <option value="name">Сортировка: по алфавиту</option>
  </select>
</div>

    
      <div id="clientsList" class="cards-grid"></div>

      <!-- Карточка клиента (модал) -->
      <dialog id="clientDialog" class="modal">
        <form method="dialog" class="modal-body glass">
          <div class="modal-head">
            <h3 id="clientModalTitle">Клиент</h3>
            <button class="btn icon" value="cancel" title="Закрыть">✕</button>
          </div>

          <div class="grid two">

<!-- 0: Язык (слева) · Пол (справа) -->
<label class="field">
  <span>Язык</span>
  <select id="fLang">
    <option value="">—</option>
    <option value="ru">Русский</option>
    <option value="en">Английский</option>
    <option value="sk">Словацкий</option>
    <option value="de">Немецкий</option>
 <option value="at">Австрия</option>
  </select>
</label>
<label class="field">
  <span>Пол</span>
  <select id="fGender">
    <option value="">—</option>
    <option value="male">Мужчина</option>
    <option value="female">Женщина</option>
  </select>
</label>  <!-- 1: Имя \ Телефон -->
  <label class="field"><span>Имя</span><input id="fName" /></label>
  <label class="field"><span>Телефон</span><input id="fPhone" /></label>

  <!-- 2: Источник \ Контакт -->
  <label class="field"><span>Источник</span><select id="fSource"></select></label>
  <label class="field"><span>Контакт (ссылка)</span><input id="fLink" placeholder="instagram / tg / vk ссылка"/></label>

  <!-- 3: Дата первого обращения \ Статус -->
  <label class="field"><span>Дата первого обращения</span><input id="fFirstContact" type="date"/></label>
  <label class="field"><span>Статус</span>
  <select id="fStatus">
  
  <option>Холодный лид</option>
<option>Лид</option>
  <option>Консультация</option>
  <option>Предоплата\эскиз</option>
  <option>Сеанс</option>
  <option>Отменил</option>
  <option>Слился</option>
</select>
</label>

  <!-- 4: Квалификация \ Комментарий к квалификации -->
  <label class="field"><span>Квалификация</span>
    <select id="fQual"><option>Целевой</option><option>Не целевой</option><option>Условно-целевой</option></select>
  </label>
  <label class="field"><span>Комментарий к квалификации</span>
    <input id="fQualNote" placeholder="почему такая квалификация"/>
  </label>

  <!-- 5: Первая тату \ Тип -->
  <label class="field"><span>Первая тату?</span>
    <select id="fFirst"><option value="true">Да</option><option value="false">Нет</option></select>
  </label>
  <label class="field"><span>Тип</span>
    <select id="fType"><option>Новая</option><option>Перекрытие</option><option>Коррекция</option></select>
  </label>

 <label class="field">
  <span>стиль (теги)</span>
  <select id="fStyles"></select>
</label>
<label class="field">
  <span>зоны</span>
  <select id="fZones"></select>
</label>

<!-- 7: Консультация (свитч слева) | Дата консультации (справа) -->
<div class="grid two" id="rowConsult">
  <!-- ЛЕВЫЙ СТОЛБЕЦ: свитч -->
  <label class="field">
    <span>Консультация</span>
    <label class="ios-switch">
      <input id="fConsultOn" type="checkbox" />
      <span class="track"></span>
    </label>
  </label>

  <!-- ПРАВЫЙ СТОЛБЕЦ: дата, появляется только при ON -->
  <label class="field" id="consultDateField" style="display:none">
    <span>Дата консультации</span>
    <input id="fConsultDate" type="datetime-local" />
  </label>
</div>

<!-- 8: Озвученная сумма (слева) | Депозит (справа) -->
<div class="grid two" id="rowMoney">
 <!-- ЛЕВЫЙ СТОЛБЕЦ: озвученная сумма -->
<label class="field">
  <span>Озвученная сумма от\до (€)</span>
  <div class="row gap-8">
    <input id="fAmountMin" type="number" step="1" inputmode="decimal" placeholder="от" />
    <input id="fAmountMax" type="number" step="1" inputmode="decimal" placeholder="до" />
  </div>
</label>

  <!-- ПРАВЫЙ СТОЛБЕЦ: депозит -->
  <label class="field">
    <span>Депозит (€)</span>
    <input id="fDeposit" type="number" step="1" inputmode="decimal" />
  </label>
</div>
  <!-- 8: Даты сеансов -->
<label class="field" style="grid-column: 1 / -1">
  <span>Даты сеансов</span>
  <div id="sessionsList"></div>
  <div class="row" style="justify-content:flex-end; margin-top:8px">
    <button id="btnAddSession" type="button" class="btn">+ Дата</button>
  </div>
</label>
  <!-- Напоминания (слева) + История статусов (справа) -->
  <div class="grid two" style="grid-column: 1 / -1; gap:12px">
    <!-- ЛЕВЫЙ столбец: напоминания -->
    <div class="panel glass">
      <div class="subtle">Напоминания</div>
      <div id="clientReminders"></div>
    </div>

    <!-- ПРАВЫЙ столбец: история смен статусов -->
    <div class="panel glass">
      <div class="subtle">История статусов</div>
      <div id="statusHistory"></div>
    </div>
  </div>

  <!-- 9: Напоминание + список напоминаний -->
  <label class="field" style="grid-column: 1 / -1"><span>Напоминание</span>
    <div class="row gap-8">
      <select id="fReminderTpl" class="chip" style="flex:1"><option value="">— шаблон —</option></select>
      <select id="fReminderAfter" class="chip" title="Когда напомнить"><option value="">дни</option></select>
    </div>
    <input id="fReminderTitle" placeholder="Свой текст напоминания (необязательно)"/>
  </label>


 
<!-- 10: Комментарии -->
<label class="field"><span>Заметка</span>
  <textarea id="fNotes" rows="3" placeholder="особенности, пожелания…"></textarea>
</label>

          <div class="panel">
            <div class="stack">
              <div class="subtle">Фото</div>
              <div id="photosEmptyNote" class="empty-note">У этого клиента пока нет фотографий.</div>
              <div class="row gap-8">
                <input id="photoInput" type="file" multiple accept="image/*" hidden/>
                <button id="attachPhotosBtn" class="btn">+ Прикрепить фотографии</button>
                <button id="openFolderBtn" class="btn ghost">Открыть папку</button>
                <button id="shareFolderBtn" class="btn ghost">Поделиться папкой</button>
              </div>

<div id="photosGrid" class="thumbs-grid"></div>

           
 </div>
          </div>

          <div class="modal-foot">
            <button class="btn danger" id="deleteClientBtn" type="button">Удалить</button>
            <div class="spacer"></div>
            <button class="btn" value="cancel">Отмена</button>
            <button class="btn primary" id="saveClientBtn" type="button">Сохранить</button>
          </div>
        </form>
      </dialog>
    </section>

<!-- Вкладка: Маркетинг -->
<section id="marketingPage" class="page">
  <div class="section">
    <h2>Маркетинг</h2>

<!-- БЛОК: Маркетинг — краткая сводка -->
<section class="block marketing-summary">
  <h2 class="chart-title">Маркетинг — краткая сводка</h2>

  <!-- ВНУТРЕННЯЯ СЕТКА 3×3 -->

  <div class="stat-grid">
    <div class="stat-card stat-card-statuses" id="mk-card-statuses">
  <div class="mk-card-title">Клиенты и статусы</div>
  <ul class="mk-list" id="mk-status-list">
</ul>
<div class="mk-subtitle" style="margin-top:8px">Instagram</div>
<div id="mk-instagram-followers" class="meta">0 новых подписчиков</div>
<!-- здесь больше НЕТ лишнего </ul> -->
</div>


  <div class="stat-card stat-card-demo" id="mk-card-demo">
  <div class="mk-card-title">Профиль клиентов</div>

<div class="mk-subtitle mk-two">
  <span>Язык/страна</span>
  <span class="right">всего</span>
</div>
<ul class="mk-list" id="mk-demo-lang"></ul>
  <div class="mk-subtitle" style="margin-top:8px">Пол</div>
  <ul class="mk-list" id="mk-demo-gender"></ul>

  <div class="mk-subtitle" style="margin-top:8px">Квалификация</div>
  <ul class="mk-list" id="mk-demo-qual"></ul>
</div>


   <!-- Карточка №3: Результаты суперфильтра -->
<div class="stat-card stat-card-results" id="mk-card-results">
  <div class="mk-card-head">
    <div class="mk-card-title">Результат фильтра</div>
    <button id="mk-filter-reset" class="mk-btn mk-btn-ghost" title="Сбросить все выбранные фильтры">Сбросить</button>
  </div>

  <div class="mk-subtitle">Подходящих клиентов: <span id="mk-result-count">0</span></div>
  <ul class="mk-list" id="mk-filter-list"></ul>
</div>

    <div class="stat-card stat-card-conv" id="mk-card-conv">
  <div class="mk-card-title">Конверсия из лидов</div>
  <ul class="mk-list" id="mk-conv-list">
    <li class="mk-row">
      <span class="label">Всего обратившихся</span>
      <span class="value" id="mk-conv-den">0</span>
    </li>
    <li class="mk-row">
      <span class="label">→ Консультации</span>
      <span class="value" id="mk-conv-consult">0 (0%)</span>
    </li>
    <li class="mk-row">
      <span class="label">→ Предоплата/эскиз</span>
      <span class="value" id="mk-conv-prepay">0 (0%)</span>
    </li>
    <li class="mk-row">
      <span class="label">→ Сеансы</span>
      <span class="value" id="mk-conv-session">0 (0%)</span>
    </li>
    <li class="mk-row">
      <span class="label">→ Отменил</span>
      <span class="value" id="mk-conv-canceled">0 (0%)</span>
    </li>
    <li class="mk-row">
      <span class="label">→ Слился</span>
      <span class="value" id="mk-conv-dropped">0 (0%)</span>
    </li>
  </ul>
</div>



    <div class="stat-card glass totals-card" id="mk-card-totals">
  <div class="tc-title">Итоги маркетинга</div>

  <ul class="tc-list">
    <li class="tc-row">
      <span class="tc-label">Всего потрачено на рекламу</span>
      <span class="tc-value" id="mk-ads-spent">€0</span>
    </li>
    <li class="tc-row">
      <span class="tc-label">Предоплаты</span>
      <span class="tc-value" id="mk-deposits">0 шт., €0</span>
    </li>
    <li class="tc-row">
      <span class="tc-label">Проведённые сеансы</span>
      <span class="tc-value" id="mk-sessions-done">0 шт., €0</span>
    </li>
    <li class="tc-row">
      <span class="tc-label">Запланированные сеансы</span>
      <span class="tc-value" id="mk-sessions-planned">0 шт., €0</span>
    </li>
  </ul>

  <div class="tc-subtitle">
    <span class="tc-label">Потенциал до даты</span>
    <input type="date" class="tc-date" id="mkPotentialUntil" />
  </div>

  <ul class="tc-list">
    <li class="tc-row">
      <span class="tc-label">Потенциал</span>
      <span class="tc-value" id="mk-potential-range">€0 — €0</span>
    </li>
  </ul>
</div>

   <!-- Карточка №6: Финансы -->
<div id="mk-card-finance" class="card glass">
  <div class="row" style="justify-content:space-between; align-items:center">
    <h3>Финансы</h3>
    <label class="switch">
      <input type="checkbox" id="mkIncludeSupplies">
      <span>Учитывать расходники</span>
    </label>
  </div>
  <ul id="mk-finance-list" class="mk-list"></ul>
</div>

    <div class="stat-card"><span>Заглушка 7</span></div>
    <div class="stat-card"><span>Заглушка 8</span></div>
    <div class="stat-card"><span>Заглушка 9</span></div>
  </div>
</section>

    <div id="mkHistory" class="glass" style="padding:10px; overflow-x:auto">
  <table class="mk-table">
    <thead>
      <tr>
        <th>Дата</th>
        <th title="+ за день">IG</th>
        <th title="Расход дня">€</th>
        <th>RU</th><th>SK</th><th>EN</th><th>AT</th><th>DE</th>
      </tr>
    </thead>
    <tbody id="mkHistoryBody"></tbody>
    <tfoot>
       <tr id="mkTotalsRow" class="mk-tfoot-line"></tr>
    </tfoot>
  </table>

  <div class="mk-legend" style="margin-top:8px; font-size:12px; opacity:.85">
    <span class="mk-dot mk-dot-cold"></span> — холодные &nbsp;|&nbsp;
    <span class="mk-pill mk-total mk-mono">Σ</span> — всего &nbsp;|&nbsp;
    <span class="mk-dot mk-dot-warm"></span> — все остальные (лиды/консы/депозиты/сеансы)
  </div>
</div>


</section> <!-- ← ЗАКРЫВАЕМ marketingPage -->

<!-- Вкладка: Расходники -->    <section id="suppliesPage" class="page">
      <div class="toolbar glass">
        <select id="supFilter" class="chip">
          <option value="">Категория: все</option>
        </select>
        <button id="addSupplyBtn" class="btn">+ Позиция</button>
      </div>
      <div id="suppliesList" class="cards-grid"></div>
    </section>

<!-- Модал: Позиция расходника -->
<dialog id="supplyDialog" class="modal">
  <form method="dialog" class="modal-body glass" id="supplyForm">
    <div class="modal-head">
      <h3 id="supplyModalTitle">Новая позиция</h3>
      <button class="btn icon" value="cancel" title="Закрыть">✕</button>
    </div>

    <div class="grid two">
      <!-- Тип расходника -->
      <label class="field">
        <span>Тип</span>
        <select id="supType" required></select>
      </label>

      <!-- Подтип -->
<label class="field">
  <span>Подтип</span>
  <select id="supKind"></select>
  <input id="supKindText" placeholder="Введите подтип" style="display:none"/>
</label>

<!-- Бренд -->
<label class="field">
  <span>Бренд</span>
  <select id="supBrand"></select>
  <input id="supBrandText" placeholder="Введите бренд" style="display:none"/>
</label>

<!-- Размер -->
<label class="field">
  <span>Размер</span>
  <select id="supSize"></select>
  <input id="supSizeText" placeholder="Введите размер" style="display:none"/>
</label>

      <!-- Название (если нужно переопределить авто-сборку имени) -->
      <label class="field">
        <span>Название (необязательно)</span>
        <input id="supName" placeholder="Если пусто — соберём из полей выше"/>
      </label>

      <!-- Кол-во -->
      <label class="field">
        <span>Количество</span>
        <input id="supQty" type="number" min="0" step="1" value="1" required/>
      </label>

      <!-- Единица -->
      <label class="field">
        <span>Единица</span>
        <input id="supUnit" placeholder="шт / мл" />
      </label>

      <!-- Ссылка на заказ (необязательно) -->
      <label class="field">
        <span>Ссылка на заказ</span>
        <input id="supLink" placeholder="https://…"/>
      </label>

      <!-- Примечание (необязательно) -->
      <label class="field">
        <span>Примечание</span>
        <input id="supNote" placeholder="бренд/цвет и т.д."/>
      </label>
    </div>

    <div class="modal-foot">
      <button class="btn danger" id="deleteSupplyBtn" type="button" style="display:none">Удалить</button>
      <div class="spacer"></div>
      <button class="btn" value="cancel">Отмена</button>
      <button class="btn primary" id="saveSupplyBtn" type="button">Сохранить</button>
    </div>
  </form>
</dialog>

    <!-- Вкладка: Настройки -->
    <section id="settingsPage" class="page">
      <div class="section">
        <h2>Настройки</h2>
        <div class="grid two">
          <label class="field"><span>Источники клиентов</span>
            <textarea id="setSources" rows="2" placeholder="Instagram, TikTok, VK, Сарафан"></textarea>
          </label>
          <label class="field"><span>Стили (теги)</span>
            <textarea id="setStyles" rows="2" placeholder="Реализм, Ч/Б, Цвет"></textarea>
          </label>
          <label class="field"><span>Зоны тела</span>
            <textarea id="setZones" rows="2" placeholder="Рука, Нога, Спина"></textarea>
          </label>
          <label class="field"><span>Категории расходников</span>
            <textarea id="setSupplies" rows="2" placeholder="Краски, Иглы, Химия"></textarea>
          </label>

<!-- Справочник расходников (сворачиваемый) -->
<div class="card glass" id="supDictCard">
  <div class="row" style="align-items:center; gap:8px;">
  <b>Справочник расходников</b>
  <div class="spacer"></div>
  <!-- iOS-переключатель -->
  <label class="ios-switch" title="Редактировать справочник">
    <input type="checkbox" id="supDictToggle">
    <span class="track"></span>
  </label>
</div>

  <!-- Содержимое редактора (просто скрываем/показываем, рендер остаётся) -->
  <div id="supDictBody">
    <div class="row" style="align-items:center; gap:8px; margin-top:8px">
      <button id="btnAddSupType" type="button" class="btn">+ Тип</button>
    </div>

    <div id="supDictEditor" style="margin-top:12px"></div>

    <!-- скрытый JSON для совместимости -->
    <textarea id="setSuppliesDict" style="display:none"></textarea>

    <div class="hint" style="margin-top:8px">
      Для каждого типа можно задать: единицу (<code>шт</code>, <code>мл</code>, <code>г</code>, …),
      подтипы (например, RL, RS), размеры (например, 3,5,7,9), бренды (для красок и т.п.).
    </div>
  </div>
</div>
          <label class="field"><span>Напоминание по умолчанию</span>
            <input id="setDefaultReminder" placeholder="Через 14 дней — Спросить про заживление">
          </label>
<label class="field"><span>Шаблоны напоминаний</span>
  <textarea id="setReminderTemplates" rows="2" placeholder="Попросить отзыв, Спросить про заживление, Отправить инструкции по уходу"></textarea>
</label>
<label class="field"><span>Шаблоны сроков (дни)</span>
  <input id="setReminderDelays" placeholder="14, 30, 180"/>
</label>

          <label class="field"><span>Интервал авто-синхронизации (сек)</span>
            <input id="setSyncInterval" type="number" min="15" step="15" />
          </label>
        </div>
        <div class="y-12"></div>
        <div class="row gap-8">
          <button id="saveSettingsBtn" class="btn primary">Сохранить настройки</button>
          <button id="logoutBtn" class="btn danger ghost">Выйти из аккаунта</button>
        </div>
      </div>
    </section>
  </main>

  <nav class="tabbar glass">
    <button data-tab="todayPage" class="tab is-active">Сегодня</button>
    <button data-tab="clientsPage" class="tab">Клиенты</button>
    <button data-tab="marketingPage" class="tab">Маркетинг</button>
    <button data-tab="suppliesPage" class="tab">Расходники</button>
  
  </nav>

  <div id="toast" class="toast"></div>

<!-- Boot overlay -->
<div id="bootOverlay" class="boot hidden">
  <div class="boot-box glass">
    <div class="boot-head">
      <b>Загрузка приложения…</b>
      <span id="bootProgress">0%</span>
    </div>
    <div id="bootSteps" class="boot-steps"></div>
    <div id="bootHint" class="boot-hint"></div>
  </div>
</div>


  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<!-- Google Identity Services (для бесшумного обновления access_token) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Google API (Drive) -->
  <script src="https://apis.google.com/js/api.js"></script>
  <!-- Твой конфиг Firebase -->
  <script src="./firebase-config.js"></script>

  <!-- Модуль для работы с Google Drive -->
  <script src="./drive.js"></script>
<script src="calendar.js"></script>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script src="./app.js"></script>
</div> <!-- .container -->
<!-- Confirm dialog (универсальный) -->
<dialog id="confirmDialog" class="glass" style="border:none; border-radius:16px; padding:16px; max-width:360px">
  <div id="confirmText" style="margin-bottom:12px">Вы уверены?</div>
  <div class="row" style="justify-content:flex-end; gap:8px">
    <button id="confirmNo" class="btn ghost">Отмена</button>
    <button id="confirmYes" class="btn danger">Удалить</button>
  </div>
</dialog>
</body>
</html>
